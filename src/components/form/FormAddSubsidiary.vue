<script lang="ts">
/**
 * FormAddSubsidiary Component
 *
 * @description * Use this component to render form for adding subsidiary.
 *
 * Note: This component is used in `FormAddCompany` and
 * `FormFieldCompanyAddress` components.
 *
 * @props
 * - `modelValue` (FormCompanyAddressFields, required): The object representing
 *   subsidiary address fields.
 *
 * @events
 * - `update:modelValue`: Emitted as a part of v-model structure.
 *
 * @components
 * - `FormFieldTextRequired`: Component to render required fields.
 *
 * @example
 * <form-add-subsidiary v-model="subsidiaryAddress" />
 *
 * @see [Figma Design](https://www.figma.com/design/L8dVREySVXxh3X12TcFDdR/Do-pr%C3%A1ce-na-kole?node-id=5366-25187&t=5mlrbbYMHyCGAh8l-1)
 */

// libraries
import { computed, defineComponent, nextTick } from 'vue';

// components
import FormFieldTextRequired from '../global/FormFieldTextRequired.vue';

// composables
import { useValidation } from 'src/composables/useValidation';

// fixtures
import cityChallengeResponse from '../../../test/cypress/fixtures/cityChallengeResponse.json';

// types
import type { FormCompanyAddressFields, FormOption } from '../types/Form';

export default defineComponent({
  name: 'FormAddSubsidiary',
  components: {
    FormFieldTextRequired,
  },
  props: {
    modelValue: {
      type: Object as () => FormCompanyAddressFields,
      required: true,
    },
  },
  emits: ['update:modelValue'],
  setup(props, { emit }) {
    const subsidiary = computed({
      get(): FormCompanyAddressFields {
        return props.modelValue;
      },
      set(value: FormCompanyAddressFields) {
        nextTick((): void => {
          emit('update:modelValue', value);
        });
      },
    });

    const optionsCityChallenge: FormOption[] =
      cityChallengeResponse.results.map((city) => ({
        label: city.name,
        value: city.id,
      }));

    const { isFilled } = useValidation();

    return {
      subsidiary,
      isFilled,
      optionsCityChallenge,
    };
  },
});
</script>

<template>
  <div class="row q-col-gutter-lg" data-cy="form-add-subsidiary">
    <div class="col-12 col-sm-6">
      <!-- Street -->
      <form-field-text-required
        v-model="subsidiary.street"
        name="street"
        label="form.labelStreet"
        data-cy="form-add-subsidiary-street"
      />
    </div>
    <div class="col-12 col-sm-6">
      <!-- House number -->
      <form-field-text-required
        v-model="subsidiary.houseNumber"
        name="houseNumber"
        label="form.labelHouseNumber"
        data-cy="form-add-subsidiary-house-number"
      />
    </div>
    <div class="col-12 col-sm-6">
      <!-- City -->
      <form-field-text-required
        v-model="subsidiary.city"
        name="city"
        label="form.labelCity"
        data-cy="form-add-subsidiary-city"
      />
    </div>
    <div class="col-12 col-sm-6">
      <!-- Zip -->
      <form-field-text-required
        v-model="subsidiary.zip"
        name="zip"
        label="form.labelZip"
        data-cy="form-add-subsidiary-zip"
      />
    </div>
    <div class="col-12">
      <!-- City challenge -->
      <label
        for="form-city-challenge"
        class="text-caption text-bold text-gray-10"
        >{{ $t('form.company.labelCityChallenge') }}</label
      >
      <q-select
        dense
        outlined
        emit-value
        map-options
        v-model="subsidiary.cityChallenge"
        :rules="[
          (val) =>
            isFilled(val) ||
            $t('form.messageFieldRequired', {
              fieldName: $t('form.labelCity'),
            }),
        ]"
        id="form-city-challenge"
        :hint="$t('form.company.hintCityChallenge')"
        :options="optionsCityChallenge"
        class="q-mt-sm"
        data-cy="form-add-subsidiary-city-challenge"
      ></q-select>
    </div>
    <div class="col-12">
      <!-- Department (note) -->
      <label for="form-department" class="text-caption text-bold text-gray-10">
        {{ $t('form.company.labelDepartment') }}
      </label>
      <q-input
        dense
        outlined
        lazy-rules
        hide-bottom-space
        v-model="subsidiary.department"
        id="form-department"
        name="department"
        :hint="$t('form.company.hintDepartment')"
        class="q-mt-sm"
        data-cy="form-add-subsidiary-department"
      />
    </div>
  </div>
</template>
